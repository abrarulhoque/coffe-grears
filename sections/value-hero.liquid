{{ 'section-value-hero.css' | asset_url | stylesheet_tag }}

{%- if section.settings.image_height == 'adapt' and section.settings.image != blank -%}
  {%- style -%}
    @media screen and (max-width: 749px) {
      #ValueHero-{{ section.id }}::before,
      #ValueHero-{{ section.id }} .value-hero__media::before {
        padding-bottom: {{ 1 | divided_by: section.settings.image.aspect_ratio | times: 100 }}%;
        content: '';
        display: block;
      }
    }

    @media screen and (min-width: 750px) {
      #ValueHero-{{ section.id }}::before,
      #ValueHero-{{ section.id }} .value-hero__media::before {
        padding-bottom: {{ 1 | divided_by: section.settings.image.aspect_ratio | times: 100 }}%;
        content: '';
        display: block;
      }
    }
  {%- endstyle -%}
{%- endif -%}

{%- style -%}
  #ValueHero-{{ section.id }}::after {
    opacity: {{ section.settings.image_overlay_opacity | divided_by: 100.0 }};
  }
{%- endstyle -%}

{%- liquid
  assign full_width = '100vw'
  assign widths = '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840'
  assign fetch_priority = 'high'
-%}

<div
  id="ValueHero-{{ section.id }}"
  class="value-hero value-hero--{{ section.settings.image_height }}{% if section.settings.image_height == 'adapt' and section.settings.image != blank %} value-hero--adapt{% endif %}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}"
  data-parallax="true"
>
  {%- if section.settings.image != blank -%}
    <div class="value-hero__media media{% if section.settings.image == blank %} placeholder{% endif %} parallax-container{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}">
      {%- liquid
        assign image_height = section.settings.image.width | divided_by: section.settings.image.aspect_ratio
      -%}
      {{
        section.settings.image
        | image_url: width: 3840
        | image_tag:
          width: section.settings.image.width,
          height: image_height,
          class: 'parallax-element',
          sizes: full_width,
          widths: widths,
          fetchpriority: fetch_priority,
          loading: 'eager'
      }}
    </div>
  {%- else -%}
    <div class="value-hero__media media placeholder parallax-container{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}">
      {{ 'hero-apparel-1' | placeholder_svg_tag: 'placeholder-svg parallax-element' }}
    </div>
  {%- endif -%}
  
  <div class="value-hero__content{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
    <div class="value-hero__text-container">
      {%- if section.settings.heading != blank -%}
        <h1 class="value-hero__heading" dir="rtl">
          {{ section.settings.heading }}
        </h1>
      {%- endif -%}
      
      {%- if section.settings.subheading != blank -%}
        <p class="value-hero__subheading" dir="rtl">
          {{ section.settings.subheading }}
        </p>
      {%- endif -%}
      
      <div class="value-hero__buttons">
        {%- if section.settings.button_label_1 != blank -%}
          <a
            {% if section.settings.button_link_1 == blank %}
              role="link" aria-disabled="true"
            {% else %}
              href="{{ section.settings.button_link_1 }}"
            {% endif %}
            class="value-hero__button value-hero__button--primary button--hover-scale"
          >
            {{- section.settings.button_label_1 | escape -}}
          </a>
        {%- endif -%}
        
        {%- if section.settings.button_label_2 != blank -%}
          <a
            {% if section.settings.button_link_2 == blank %}
              role="link" aria-disabled="true"
            {% else %}
              href="{{ section.settings.button_link_2 }}"
            {% endif %}
            class="value-hero__button value-hero__button--secondary button--hover-scale"
          >
            {{- section.settings.button_label_2 | escape -}}
          </a>
        {%- endif -%}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const hero = document.querySelector('#ValueHero-{{ section.id }}');
    const parallaxElement = hero.querySelector('.parallax-element');
    
    if (parallaxElement && window.matchMedia('(min-width: 750px)').matches) {
      let ticking = false;
      
      function updateParallax() {
        const rect = hero.getBoundingClientRect();
        const speed = 0.5;
        const yPos = -(rect.top * speed);
        const maxOffset = 8;
        const clampedOffset = Math.max(-maxOffset, Math.min(maxOffset, yPos));
        
        parallaxElement.style.transform = `translate3d(0, ${clampedOffset}px, 0)`;
        ticking = false;
      }
      
      function requestParallaxUpdate() {
        if (!ticking) {
          requestAnimationFrame(updateParallax);
          ticking = true;
        }
      }
      
      let scrollTimeout;
      window.addEventListener('scroll', function() {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(requestParallaxUpdate, 16);
      });
    }
  });
</script>

{% schema %}
{
  "name": "Value Hero",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "image_picker",
      "id": "image",
      "label": "Background image"
    },
    {
      "type": "range",
      "id": "image_overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "%",
      "label": "Image overlay opacity",
      "default": 20
    },
    {
      "type": "select",
      "id": "image_height",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to image"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "large",
      "label": "Image height"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "أدوات قهوة مميزة — مختارة بعناية",
      "label": "Heading (Arabic)"
    },
    {
      "type": "inline_richtext",
      "id": "subheading",
      "default": "معدات أصلية، شحن سريع، دعم من عشّاق القهوة مثلك.",
      "label": "Subheading (Arabic)"
    },
    {
      "type": "header",
      "content": "Primary Button"
    },
    {
      "type": "text",
      "id": "button_label_1",
      "default": "تسوق الآن",
      "label": "Primary button label"
    },
    {
      "type": "url",
      "id": "button_link_1",
      "label": "Primary button link"
    },
    {
      "type": "header",
      "content": "Secondary Button"
    },
    {
      "type": "text",
      "id": "button_label_2",
      "default": "تسوق حسب الفئة",
      "label": "Secondary button label"
    },
    {
      "type": "url",
      "id": "button_link_2",
      "label": "Secondary button link"
    }
  ],
  "presets": [
    {
      "name": "Value Hero"
    }
  ]
}
{% endschema %}